!function(){function checkLayout(e){e.dataset.originalLayout||(e.classList.contains("image-exif-float")?e.dataset.originalLayout="float":(e.classList.contains("image-exif-block"),e.dataset.originalLayout="block"));const t=e.querySelector(".image-exif-info-card"),i=function checkSideLayout(e){const t=e.querySelector(".image-exif-image-wrapper"),i=e.querySelector(".image-exif-info-card");if(!t||!i)return!1;const a=t.querySelector("img.image-exif-img"),o=t.querySelector(".img-preloader");let l=0,s=0;if(a&&a.complete&&a.naturalHeight>0?(l=a.offsetHeight||a.clientHeight,s=a.offsetWidth||a.clientWidth):o&&(l=o.offsetHeight||o.clientHeight,s=o.offsetWidth||o.clientWidth),0===l||0===s)return!1;const n=e.getBoundingClientRect().width,r=n-s-24-10;if(r>=130){const t=i.cloneNode(!0);t.classList.remove("expanded");const a=Math.min(r,400);Object.assign(t.style,{display:"block",visibility:"hidden",position:"absolute",top:"0",left:"0",width:a+"px",height:"auto",maxHeight:"none",padding:"0.65rem",boxSizing:"border-box",zIndex:"-9999"});const o=t.querySelector(".image-exif-data");o&&Object.assign(o.style,{display:"grid",height:"auto",marginTop:"0.6rem",gridTemplateColumns:"repeat(auto-fit, minmax(130px, 1fr))",gap:"0.6rem"});const s=t.querySelector(".image-exif-toggle-btn");s&&(s.style.display="none"),e.appendChild(t);const n=t.offsetHeight;if(e.removeChild(t),n<=1.1*l)return e.classList.contains("image-exif-side")||(e.classList.add("image-exif-side"),e.classList.remove("image-exif-overflow-fallback"),i.style.display="",i.style.visibility="",i.style.opacity=""),i.style.maxWidth=a+"px",i.querySelector(".image-exif-data")&&(i.querySelector(".image-exif-data").style.gridTemplateColumns=""),!0}return!1}(e);i||(e.classList.contains("image-exif-side")&&e.classList.remove("image-exif-side"),t&&(t.style.maxWidth="",t.querySelector(".image-exif-data")&&(t.querySelector(".image-exif-data").style.gridTemplateColumns="")),"float"===e.dataset.originalLayout?function checkFloatLayout(e){if(e.classList.contains("image-exif-side"))return;const t=e.querySelector(".image-exif-image-wrapper"),i=e.querySelector(".image-exif-info-card");if(!t||!i)return;const a=t.querySelector("img.image-exif-img"),o=t.querySelector(".img-preloader");let l=0;if(a&&a.complete&&a.naturalHeight>0?l=a.offsetHeight||a.clientHeight:o&&(l=o.offsetHeight||o.clientHeight),0===l)return;i.querySelectorAll(".image-exif-item").length;const s=i.cloneNode(!0);s.classList.remove("expanded"),Object.assign(s.style,{display:"block",visibility:"hidden",position:"absolute",top:"0",left:"0",width:"max-content",maxWidth:"60%",height:"auto",maxHeight:"none",overflow:"visible",boxSizing:"border-box",padding:"0.65rem",background:"transparent",zIndex:"-9999"});const n=s.querySelector(".image-exif-data"),r=s.querySelector(".image-exif-toggle-btn");r&&(r.style.display="none"),t.appendChild(s);const c=l-24;let d=1,g=99999;const f=.6*t.offsetWidth-22;let m=Math.floor((f+10)/190);var u;m=Math.max(1,Math.min(4,m)),u=m,g=n?(Object.assign(n.style,{display:"grid",height:"auto",opacity:"1",marginTop:"0.6rem",gridTemplateColumns:`repeat(${u}, 1fr)`,gap:"0.6rem"}),n.style.gridTemplateColumns=`repeat(${u}, minmax(180px, 1fr))`,Math.max(s.offsetHeight,s.scrollHeight)):99999,d=m,t.removeChild(s),g>c-2?e.classList.contains("image-exif-overflow-fallback")||(e.classList.add("image-exif-overflow-fallback"),i.querySelector(".image-exif-data")&&(i.querySelector(".image-exif-data").style.gridTemplateColumns=""),i.style.display="",i.style.visibility="",i.style.opacity=""):(e.classList.contains("image-exif-overflow-fallback")&&(i.style.transition="none",e.classList.remove("image-exif-overflow-fallback"),i.offsetHeight,i.style.transition=""),i.querySelector(".image-exif-data")&&(i.querySelector(".image-exif-data").style.gridTemplateColumns=`repeat(${d}, minmax(180px, 1fr))`))}(e):(e.classList.contains("image-exif-overflow-fallback")&&e.classList.remove("image-exif-overflow-fallback"),t&&(t.style.display="",t.style.visibility="",t.style.opacity="")))}function initImageExif(){document.querySelectorAll(".image-exif-container").forEach((e=>{e.querySelectorAll(".image-exif-toggle-btn").forEach((e=>{e.addEventListener("click",(t=>{t.stopPropagation(),function handleToggle(e){const t=e.closest(".image-exif-info-card");if(!t)return;const i=t.querySelector(".image-exif-data");if(!i)return;t.classList.contains("expanded")?(i.style.height=i.scrollHeight+"px",i.offsetHeight,t.classList.remove("expanded"),i.style.height="0"):(i.style.height="0px",i.offsetHeight,t.classList.add("expanded"),i.style.height=i.scrollHeight+"px",i.addEventListener("transitionend",(function(){t.classList.contains("expanded")&&(i.style.height="auto")}),{once:!0}))}(e)}))})),checkLayout(e);e.querySelectorAll("img.image-exif-img").forEach((t=>{t.complete||t.addEventListener("load",(()=>{checkLayout(e)}))}));const t=e.querySelector(".image-exif-image-wrapper");if(t&&t.querySelector(".img-preloader")){new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{"IMG"===t.tagName&&(t.complete?checkLayout(e):t.addEventListener("load",(()=>{checkLayout(e)})))}))}))})).observe(t,{childList:!0})}}))}function handleResize(){document.querySelectorAll(".image-exif-container").forEach((e=>{checkLayout(e)}))}let e,t=!1;function debouncedResize(){t||(clearTimeout(e),e=setTimeout((()=>{t||(t=!0,requestAnimationFrame((()=>{handleResize(),t=!1})))}),150))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initImageExif):initImageExif(),document.addEventListener("swup:contentReplaced",initImageExif),document.addEventListener("pjax:complete",initImageExif),window.addEventListener("resize",debouncedResize);const i=document.querySelector(".page-aside-toggle");i&&i.addEventListener("click",(()=>{setTimeout(handleResize,300)})),window.addEventListener("redefine:force-exif-check",debouncedResize)}();
//# sourceMappingURL=imageExif.js.map