!function(){function gridWidth(e){return 140*e+10*Math.max(0,e-1)}function computeGridCols(e,t,i){if(e<=0)return 1;const o=function getDivisors(e){const t=[];for(let i=1;i<=e;i++)e%i==0&&t.push(i);return t}(e);if(("side"===i||"float"===i)&&e%2!=0)return 1;if("block"===i&&e%2!=0)return gridWidth(e)<=t?e:1;if("viewer"===i){for(let e=o.length-1;e>=0;e--)if(gridWidth(o[e])<=t)return o[e];return 1}return o.includes(2)&&gridWidth(2)<=t?2:1}function applyGridCols(e,t){e&&(e.style.gridTemplateColumns=t<=1?"1fr":`repeat(${t}, minmax(140px, 1fr))`)}function sectionCount(e){const t=e.querySelector(".image-exif-data");return t?t.querySelectorAll(".image-exif-section").length:0}function getImageDimensions(e){const t=e.querySelector(".image-exif-image-wrapper");if(!t)return{w:0,h:0};const i=t.querySelector("img.image-exif-img"),o=t.querySelector(".img-preloader");return i&&i.complete&&i.naturalHeight>0?{w:i.offsetWidth||i.clientWidth,h:i.offsetHeight||i.clientHeight}:o?{w:o.offsetWidth||o.clientWidth,h:o.offsetHeight||o.clientHeight}:{w:0,h:0}}function trySideLayout(e){const t=e.querySelector(".image-exif-info-card"),i=e.querySelector(".image-exif-data");if(!t)return!1;const{w:o,h:n}=getImageDimensions(e);if(0===o||0===n)return!1;const a=e.getBoundingClientRect().width-o-24-10;if(a<130)return!1;const s=Math.min(a,400),l=computeGridCols(sectionCount(e),s-21,"side"),r=t.cloneNode(!0);r.classList.remove("expanded");const c=getComputedStyle(t);Object.assign(r.style,{display:"block",visibility:"hidden",position:"absolute",top:0,left:0,zIndex:-9999,width:s+"px",height:"auto",maxHeight:"none",padding:c.padding,border:c.border,boxSizing:c.boxSizing,fontSize:c.fontSize,fontFamily:c.fontFamily,lineHeight:c.lineHeight});const d=r.querySelector(".image-exif-data");d&&(Object.assign(d.style,{display:"grid",height:"auto",opacity:"1",marginTop:"0.6rem"}),applyGridCols(d,l));const f=r.querySelector(".image-exif-toggle-btn");f&&(f.style.display="none"),e.appendChild(r);const g=r.offsetHeight;return e.removeChild(r),!(g>1.1*n)&&(e.classList.contains("image-exif-side")||(e.classList.add("image-exif-side"),e.classList.remove("image-exif-overflow-fallback"),t.style.display="",t.style.visibility="",t.style.opacity=""),t.style.maxWidth=s+"px",applyGridCols(i,l),!0)}function tryFloatLayout(e){if(e.classList.contains("image-exif-side"))return;const t=e.querySelector(".image-exif-image-wrapper"),i=e.querySelector(".image-exif-info-card"),o=e.querySelector(".image-exif-data");if(!t||!i)return;const{w:n,h:a}=getImageDimensions(e);if(0===a)return;const s=sectionCount(e),l=computeGridCols(s,.6*n-21,"float"),r=i.cloneNode(!0);r.classList.remove("expanded");const c=getComputedStyle(i);Object.assign(r.style,{display:"block",visibility:"hidden",position:"absolute",top:0,left:0,zIndex:-9999,width:"max-content",maxWidth:"60%",height:"auto",maxHeight:"none",overflow:"visible",background:"transparent",padding:c.padding,border:c.border,boxSizing:c.boxSizing,fontSize:c.fontSize,fontFamily:c.fontFamily,lineHeight:c.lineHeight});const d=r.querySelector(".image-exif-data");d&&(Object.assign(d.style,{display:"grid",height:"auto",opacity:"1",marginTop:"0.6rem"}),applyGridCols(d,l));const f=r.querySelector(".image-exif-toggle-btn");f&&(f.style.display="none"),t.appendChild(r);const g=Math.max(r.offsetHeight,r.scrollHeight);t.removeChild(r);if(g>a-24-2){e.classList.contains("image-exif-overflow-fallback")||(e.classList.add("image-exif-overflow-fallback"),i.style.display="",i.style.visibility="",i.style.opacity="");applyGridCols(o,computeGridCols(s,e.getBoundingClientRect().width-21,"block"))}else e.classList.contains("image-exif-overflow-fallback")&&(i.style.transition="none",e.classList.remove("image-exif-overflow-fallback"),i.offsetHeight,i.style.transition=""),applyGridCols(o,l)}function checkLayout(e){e.dataset.originalLayout||(e.dataset.originalLayout=e.classList.contains("image-exif-float")?"float":"block");const t=e.querySelector(".image-exif-info-card"),i=e.querySelector(".image-exif-data");trySideLayout(e)||(e.classList.remove("image-exif-side"),t&&cleanSideInline(t,i),"float"!==e.dataset.originalLayout?(e.classList.remove("image-exif-overflow-fallback"),t&&(t.style.display="",t.style.visibility="",t.style.opacity=""),applyBlockGrid(e)):tryFloatLayout(e))}function applyBlockGrid(e){applyGridCols(e.querySelector(".image-exif-data"),computeGridCols(sectionCount(e),e.getBoundingClientRect().width-21,"block"))}function cleanSideInline(e,t){e.style.maxWidth="",t&&(t.style.gridTemplateColumns="")}const e=new ResizeObserver((e=>{for(const t of e)requestAnimationFrame((()=>{t.target.classList.contains("image-exif-container")&&checkLayout(t.target)}))}));function initImageExif(){document.querySelectorAll(".image-exif-container").forEach((t=>{if(t.dataset.imageExifInit)return;t.dataset.imageExifInit="true",e.observe(t),t.querySelectorAll(".image-exif-toggle-btn").forEach((e=>{e.addEventListener("click",(t=>{t.stopPropagation(),function handleToggle(e){const t=e.closest(".image-exif-info-card");if(!t)return;const i=t.querySelector(".image-exif-data");i&&(t.classList.contains("expanded")?(i.style.height=i.scrollHeight+"px",i.offsetHeight,t.classList.remove("expanded"),i.style.height="0"):(i.style.height="0px",i.offsetHeight,t.classList.add("expanded"),i.style.height=i.scrollHeight+"px",i.addEventListener("transitionend",(function onEnd(){t.classList.contains("expanded")&&(i.style.height="auto"),i.removeEventListener("transitionend",onEnd)}))))}(e)}))})),checkLayout(t),setTimeout((()=>checkLayout(t)),300),t.querySelectorAll("img.image-exif-img").forEach((e=>{e.complete||e.addEventListener("load",(()=>checkLayout(t)))}));const i=t.querySelector(".image-exif-image-wrapper");i&&i.querySelector(".img-preloader")&&new MutationObserver((e=>{for(const i of e)for(const e of i.addedNodes)if("IMG"===e.tagName){const run=()=>requestAnimationFrame((()=>checkLayout(t)));e.complete?run():e.addEventListener("load",run)}})).observe(i,{childList:!0})}))}let t=null,i=!1;function handleResize(){document.querySelectorAll(".image-exif-container").forEach(checkLayout)}function debouncedResize(){i||(clearTimeout(t),t=setTimeout((()=>{i=!0,requestAnimationFrame((()=>{handleResize(),i=!1}))}),150))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initImageExif):initImageExif(),document.addEventListener("swup:contentReplaced",initImageExif),document.addEventListener("pjax:complete",initImageExif);try{"undefined"!=typeof swup&&swup?.hooks?.on&&swup.hooks.on("page:view",(()=>{initImageExif(),setTimeout(initImageExif,50)}))}catch(e){}window.addEventListener("resize",debouncedResize);const o=document.querySelector(".page-aside-toggle");o&&o.addEventListener("click",(()=>setTimeout(handleResize,300))),window.addEventListener("redefine:force-exif-check",debouncedResize),window.addEventListener("redefine:image-loaded",(e=>{const t=e.detail?.img;if(t){const e=t.closest(".image-exif-container");e&&requestAnimationFrame((()=>checkLayout(e)))}}))}();
//# sourceMappingURL=imageExif.js.map