export default function initAutoHover(){!function initHomeArticleAutoHover(){const e=document.querySelector(".home-article-list");if(!e||"1"===e.dataset.autoHoverInit)return;e.dataset.autoHoverInit="1";const t=Array.from(e.querySelectorAll(".home-article-item"));if(!t.length)return;let n=null,i=!1,o=!1;const s="a,button,input,textarea,select,summary,[role='button'],[tabindex]:not([tabindex='-1']),.home-article-item",isListInView=()=>{const t=e.getBoundingClientRect();return t.bottom>0&&t.top<window.innerHeight},update=()=>{if(i=!1,!isListInView()||o)return n&&n.classList.remove("auto-hover"),void(n=null);const e=window.innerHeight/2;let s=null,r=1/0;for(const n of t){const t=n.getBoundingClientRect();if(t.bottom<=0||t.top>=window.innerHeight)continue;const i=Math.abs(t.top+t.height/2-e);i<r&&(r=i,s=n)}s!==n&&(n&&n.classList.remove("auto-hover"),s&&s.classList.add("auto-hover"),n=s)},requestUpdate=()=>{i||(i=!0,requestAnimationFrame(update))},setUserHover=e=>{o!==e&&(o=e,e&&n&&(n.classList.remove("auto-hover"),n=null),requestUpdate())};document.addEventListener("pointerover",(e=>{e.target&&e.target.closest(s)&&setUserHover(!0)}),{passive:!0}),document.addEventListener("pointerout",(e=>{const t=e.relatedTarget;t&&t.closest&&t.closest(s)||setUserHover(!1)}),{passive:!0}),window.addEventListener("scroll",requestUpdate,{passive:!0}),window.addEventListener("resize",requestUpdate),requestUpdate()}(),function initArticleMediaAutoHover(){const n=document.documentElement;"1"!==n.dataset.articleMediaAutoHoverGlobalInit&&(n.dataset.articleMediaAutoHoverGlobalInit="1",function installGlobalListeners(){document.addEventListener("pointerover",(n=>{const i=n.target;i&&i.closest&&(e.active&&i.closest(".auto-hover")||i.closest(t)&&(e.hoveringInteractive=!0,clearActive()))}),{passive:!0}),document.addEventListener("pointerout",(n=>{const i=n.relatedTarget;i&&i.closest&&i.closest(t)||(e.hoveringInteractive=!1,requestUpdate())}),{passive:!0}),document.addEventListener("click",(()=>{const t=1e4;e.suspendUntil=Date.now()+t,e.hoveringInteractive=!1,clearActive(),e.resumeTimer&&clearTimeout(e.resumeTimer),e.resumeTimer=setTimeout((()=>{requestUpdate()}),t)}),{passive:!0}),window.addEventListener("scroll",requestUpdate,{passive:!0}),window.addEventListener("resize",(()=>{refreshCandidates(),requestUpdate()}));try{swup.hooks.on("page:view",(()=>{refreshCandidates(),requestUpdate()}))}catch(e){}}());refreshCandidates(),requestUpdate()}(),function initMasonryAutoHover(){if(!document.getElementById("masonry-container"))return;mRefreshItems(),n.inited||(n.inited=!0,function mInstallListeners(){window.addEventListener("scroll",mRequestUpdate,{passive:!0}),window.addEventListener("resize",(()=>{mRefreshItems(),mRequestUpdate()})),document.addEventListener("click",(e=>{if(!document.getElementById("masonry-container"))return;const t=e.target;if(t&&t.closest&&!t.closest(".image-container")&&!t.closest(".masonry-heart-btn")){n.suspended=!0;for(const e of n.actives)e.classList.remove("auto-hover");n.actives.clear(),n.suspendTimer&&clearTimeout(n.suspendTimer),n.suspendTimer=setTimeout((()=>{n.suspended=!1,mRequestUpdate()}),5e3)}}),{passive:!0});try{swup.hooks.on("page:view",(()=>{n.suspended=!1,n.suspendTimer&&clearTimeout(n.suspendTimer),mRefreshItems(),mRequestUpdate()}))}catch(e){}}());mRequestUpdate()}()}const e={candidates:[],active:null,ticking:!1,hoveringInteractive:!1,suspendUntil:0,resumeTimer:null},t="a,button,input,textarea,select,summary,[role='button'],[tabindex]:not([tabindex='-1']),.page-aside-toggle,.right-bottom-tools,.right-bottom-tools *,.post-toc,.post-toc *,.navbar,.navbar *";function refreshCandidates(){const t=[];document.querySelectorAll("figure.image-caption").forEach((e=>{const n=e.querySelector("img, .img-preloader");n&&(e.classList.contains("image-exif-container")||t.push({type:"caption",element:e,img:n}))}));document.querySelectorAll(".image-exif-container.image-exif-float").forEach((e=>{const n=e.querySelector("img, .img-preloader");n&&t.push({type:"exif-float",element:e,img:n})})),e.candidates=t,e.active&&!e.candidates.some((t=>t.element===e.active.element))&&clearActive()}function clearActive(){e.active&&(e.active.element.classList.remove("auto-hover"),e.active=null)}function isInCenterBand(e,t){const n=t/2,i=.15*t,o=e.top+e.height/2;return Math.abs(o-n)<=i}function update(){if(e.ticking=!1,!e.candidates.length)return;if(function shouldSuspend(){return e.hoveringInteractive||Date.now()<e.suspendUntil}()){const t=window.innerHeight;const n=t/2;let i=null,o=1/0;for(const s of e.candidates){const e=s.img.getBoundingClientRect();if(e.bottom<=0||e.top>=t)continue;const r=Math.abs(e.top+e.height/2-n);r<o&&(o=r,i=s)}if(i){const n=i.img.getBoundingClientRect();if(!(Math.min(n.bottom,t)-Math.max(n.top,0)<.2*n.height))return void clearActive();e.suspendUntil=0}else e.suspendUntil=0}const t=window.innerHeight,n=t/2;let i=null,o=1/0;for(const s of e.candidates){if(!s.img.isConnected){const e=s.element.querySelector("img, .img-preloader");if(!e)continue;s.img=e}const e=s.img.getBoundingClientRect();if(e.bottom<=0||e.top>=t)continue;if(!isInCenterBand(e,t))continue;const r=Math.abs(e.top+e.height/2-n);r<o&&(o=r,i=s)}i?function setActive(t){e.active&&e.active.element===t.element||(clearActive(),t.element.classList.add("auto-hover"),e.active=t)}(i):clearActive()}function requestUpdate(){e.ticking||(e.ticking=!0,requestAnimationFrame(update))}const n={items:[],actives:new Set,ticking:!1,suspended:!1,suspendTimer:null,inited:!1};function mRefreshItems(){const e=[];document.querySelectorAll("#masonry-container .masonry-item .image-container").forEach((t=>{const n=t.querySelector("img, .img-preloader");n&&e.push({el:t,img:n})})),n.items=e;for(const t of n.actives)e.some((e=>e.el===t))||(t.classList.remove("auto-hover"),n.actives.delete(t))}function mIsInBand(e,t){const n=.1*t,i=.9*t,o=e.top+e.height/2;return o>=n&&o<=i}function mUpdate(){if(n.ticking=!1,!n.items.length)return;if(n.suspended){for(const e of n.actives)e.classList.remove("auto-hover");return void n.actives.clear()}const e=window.innerHeight,t=new Set;for(const i of n.items){if(!i.img.isConnected){const e=i.el.querySelector("img, .img-preloader");if(!e)continue;i.img=e}const n=i.img.getBoundingClientRect();n.top<0||n.bottom>e||mIsInBand(n,e)&&t.add(i.el)}for(const e of n.actives)t.has(e)||e.classList.remove("auto-hover");for(const e of t)n.actives.has(e)||e.classList.add("auto-hover");n.actives=t}function mRequestUpdate(){n.ticking||(n.ticking=!0,requestAnimationFrame(mUpdate))}
//# sourceMappingURL=autoHover.js.map