const e=new WeakSet;let r=null;async function processPreloader(e){if("true"===e.dataset.loading||"true"===e.dataset.loaded)return;e.dataset.loading="true";const r=e.dataset.src,t=e.dataset.alt||"",o=e.dataset.width,a=e.dataset.height,s=function isCrossOrigin(e){try{return new URL(e,window.location.href).origin!==window.location.origin}catch{return!0}}(r);try{const n=s?await function loadImageDirect(e){return new Promise(((r,t)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>r(e),o.onerror=()=>{const o=new Image;o.onload=()=>r(e),o.onerror=()=>t(new Error("Failed to load image")),o.src=e},o.src=e}))}(r):await function loadImageXHR(e){return new Promise(((r,t)=>{const o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=()=>{if(o.status>=200&&o.status<300){const e=URL.createObjectURL(o.response);r(e)}else t(new Error(`HTTP ${o.status}: ${o.statusText}`))},o.onerror=()=>t(new Error("Network error")),o.ontimeout=()=>t(new Error("Timeout")),o.timeout=3e4,o.send()}))}(r),i=document.createElement("img");i.src=n,i.alt=t,i.dataset.originalSrc=r,i.dataset.blobSrc=n,o&&(i.width=parseInt(o,10)),a&&(i.height=parseInt(a,10));const d=Array.from(e.classList).filter((e=>!e.startsWith("img-preloader")));d.length>0&&(i.className=d.join(" ")),i.classList.add("img-preloader-loaded"),e.dataset.loaded="true",e.classList.add("img-preloader-fade-out"),setTimeout((()=>{e.parentNode&&e.parentNode.replaceChild(i,e),setTimeout((()=>URL.revokeObjectURL(n)),1e3)}),200)}catch(t){console.error("[img-preloader] Failed:",r,t),e.classList.add("img-preloader-error");const o=e.querySelector(".img-preloader-skeleton");o&&(o.innerHTML=`\n        <i class="fa-solid fa-circle-xmark img-preloader-error-icon"></i>\n        <div class="img-preloader-error-text">\n          <div class="error-message">Failed to load image</div>\n          <div class="error-url">${r}</div>\n        </div>\n      `),e.dataset.loading="false"}}export default function initLazyLoad(){const t=document.querySelectorAll(".img-preloader");if(0===t.length)return;const o=function createObserver(){return r||(r=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=e.target;r.unobserve(t),processPreloader(t)}}))}),{rootMargin:"50px 0px",threshold:.01}),r)}();t.forEach((r=>{e.has(r)||"true"===r.dataset.loaded||(e.add(r),o.observe(r))}))}export function forceLoadAllPreloaders(){document.querySelectorAll(".img-preloader").forEach((e=>{"true"!==e.dataset.loaded&&"true"!==e.dataset.loading&&processPreloader(e)}))}
//# sourceMappingURL=lazyload.js.map